import subprocess

def change_passwords(users, new_password):
    for user in users:
        # Change the password using the 'passwd' command
        passwd_process = subprocess.Popen(['sudo', 'passwd', user], stdin=subprocess.PIPE, stdout=subprocess.PIPE)
        passwd_process.communicate(input=f'{new_password}\n{new_password}\n'.encode())

        # Check the exit code to determine if the password change was successful
        if passwd_process.returncode == 0:
            print(f"Password changed successfully for user '{user}'")
        else:
            print(f"Failed to change password for user '{user}'")

# Example usage
user_list = ['user1', 'user2', 'user3']
new_password = 'new_password'

change_passwords(user_list, new_password)
